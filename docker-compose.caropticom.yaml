services:
  caropticom-api:
    image: acrcaropticomwesteuropedev002.azurecr.io/caropticom-api:${CAROPTICOM_API_VERSION}
    ports:
      - "${CAROPTICOM_API_HTTP_PORT}:8080"
      - "${CAROPTICOM_API_HTTPS_PORT}:8081"
    volumes:
      - ${HTTPS_CERT_PATH}/${HTTPS_CERT_NAME_KEY}:/usr/local/share/ssl/${HTTPS_CERT_NAME_KEY}:ro
    environment:
      - ASPNETCORE_ENVIRONMENT=${DOTNET_ENVIRONMENT:-production}
      - ASPNETCORE_HTTP_PORTS=8080
      - ASPNETCORE_HTTPS_PORTS=8081
      - ASPNETCORE_Kestrel__Certificates__Default__Path=/usr/local/share/ca-certificates/${HTTPS_CERT_NAME_CRT}
      - ASPNETCORE_Kestrel__Certificates__Default__KeyPath=/usr/local/share/ssl/${HTTPS_CERT_NAME_KEY}
      - OltpEndPointUrl=${OLTP_ENDPOINT_URL}
      - Serilog__WriteTo__1__Args__serverUrl=${SEQ_SERVER_URL}
      - OltpAppName=${CAROPTICOM_API_OLTP_APP_NAME}
      - SENTRY_DSN=${CAROPTICOM_API_SENTRY_DSN:-}
      - Logging__LogLevel__Default=${LOGGING__LOGLEVEL__DEFAULT:-Debug}
      - Logging__LogLevel__Microsoft=${LOGGING__LOGLEVEL__SYSTEM:-Information}
      - Logging__LogLevel__System=${LOGGING__LOGLEVEL__MICROSOFT:-Information}
      - ApplicationUrl=${APPLICATIONURL}
      - Frontend__ClientId=${FRONTEND__CLIENTID}
      - Frontend__Authority=${FRONTEND__AUTHORITY}
      - Frontend__KnownAuthorities__1=${FRONTEND__KNOWNAUTHORITIES__1}
      - AzureAdAuthentication__Instance=${AZUREADAUTHENTICATION__INSTANCE}
      - AzureAdAuthentication__TenantId=${AZUREADAUTHENTICATION__TENANTID}
      - AzureAdAuthentication__Domain=${AZUREADAUTHENTICATION__DOMAIN}
      - AzureAdAuthentication__ClientId=${AZUREADAUTHENTICATION__CLIENTID}
      - AzureAdAuthentication__TokenValidationParameters__ValidateIssuer=${AZUREADAUTHENTICATION__TOKENVALIDATIONPARAMETERS__VALIDATEISSUER}
      - AzureAdAuthentication__TokenValidationParameters__ValidIssuer=${AZUREADAUTHENTICATION__TOKENVALIDATIONPARAMETERS__VALIDISSUER}
      - AzureAdAuthentication__TokenValidationParameters__ValidateAudience=${AZUREADAUTHENTICATION__TOKENVALIDATIONPARAMETERS__VALIDATEAUDIENCE}
      - AzureAdAuthentication__TokenValidationParameters__ValidAudiences__1=${AZUREADAUTHENTICATION__TOKENVALIDATIONPARAMETERS__VALIDAUDIENCES__1}
      - AzureAdAuthentication__TokenValidationParameters__ValidAudiences__1=${AZUREADAUTHENTICATION__TOKENVALIDATIONPARAMETERS__VALIDAUDIENCES__1}
      - AzureAdAuthentication__AllowWebApiToBeAuthorizedByACL=${AZUREADAUTHENTICATION__ALLOWWEBAPIOTBEAUTHORIZEDBYACL}
      - AzureAdAuthentication__CallbackPath=${AZUREADAUTHENTICATION__CALLBACKPATH}
      - AzureAdAuthentication__ClientSecret=${AZUREADAUTHENTICATION__CLIENTSECRET}
      - AzureAdAuthentication__SignUpSignInPolicyId=${AZUREADAUTHENTICATION__SIGNUPSIGNINPOLICYID}
      - AzureAdInfrastructure__TenantId=${AZUREADINFRASTRUCTURE__TENANTID}
      - AzureAdInfrastructure__ClientId=${AZUREADINFRASTRUCTURE__CLIENTID}
      - AzureAdInfrastructure__ClientSecret=${AZUREADINFRASTRUCTURE__CLIENTSECRET}
      - AzureAdInfrastructure__GraphApiUrl=${AZUREADINFRASTRUCTURE__GRAPHAPIURL}
      - AzureAdInfrastructure__IdentityIssuer=${AZUREADINFRASTRUCTURE__IDENTITYISSUER}
      - OptipixAPI__CaropticomWebhooksHandlerBaseUrl=${OPTIPIXAPI__CAROPTICOMWEBHOOKSHANDLERBASEURL}
      - OptipixAPI__Url=${OPTIPIXAPI__URL}
      - OptipixAPI__Email=${OPTIPIXAPI__EMAIL}
      - OptipixAPI__Password=${OPTIPIXAPI__PASSWORD}
      - OptipixAPI__TokenExpirationThreshold=${OPTIPIXAPI__TOKENEXPIRATIONTHRESHOLD}
      - OptipixAPI__RetriesCount=${OPTIPIXAPI__RETRIESCOUNT}
      - OptipixAPI__MaxErrorsAllowed=${OPTIPIXAPI__MAXERRORSALLOWED}
      - OptipixAPI__UnavailabilityBreak=${OPTIPIXAPI__UNAVAILABILITYBREAK}
      - OptipixAuthorizationAPI__PasswordEncryptionKey=${OPTIPIXAUTHORIZATIONAPI__PASSWORDENCRYPTIONKEY}
      - KeysManagementInfrastructure__TenantId=${KEYSMANAGEMENTINFRASTRUCTURE__TENANTID}
      - KeysManagementInfrastructure__ClientId=${KEYSMANAGEMENTINFRASTRUCTURE__CLIENTID}
      - KeysManagementInfrastructure__ClientSecret=${KEYSMANAGEMENTINFRASTRUCTURE__CLIENTSECRET}
      - KeysManagementInfrastructure__OptipixKeyVaultUrl=${KEYSMANAGEMENTINFRASTRUCTURE__OPTIPIXKEYVAULTURL}
      - BlobStorageInfrastructure__ConnectionString=${BLOBSTORAGEINFRASTRUCTURE__CONNECTIONSTRING}
      - BlobStorageInfrastructure__ContainerName=${BLOBSTORAGEINFRASTRUCTURE__CONTAINERNAME}
      - CosmosDbAuthorizationStorage__ConnectionString=${COSMOSDBAUTHORIZATIONSTORAGE__CONNECTIONSTRING}
      - CosmosDbAuthorizationStorage__DatabaseId=${COSMOSDBAUTHORIZATIONSTORAGE__DATABASEID}
      - CosmosDbAuthorizationStorage__Throughput=${COSMOSDBAUTHORIZATIONSTORAGE__THROUGHPUT}
      - CosmosDbAuthorizationStorage__UseIntegratedCache=${COSMOSDBAUTHORIZATIONSTORAGE__USEINTEGRATEDCACHE}
      - HubSpotAPI__StaticToken=${HUBSPOTAPI__STATICTOKEN}
      - HubSpotAPI__BaseUrl=${HUBSPOTAPI__BASEURL}
      - HubSpotAPI__AllowAutomaticSync=${HUBSPOTAPI__ALLOWAUTOMATICSYNC}
      - HubSpotAPI__HubSpotCompaniesUpdatePeriodSeconds=${HUBSPOTAPI__HUBSPOTCOMPANIESUPDATEPERIODSECONDS}
      - HubSpotAPI_HubSpotPropertyUpdatePeriodSeconds_=${HUBSPOTAPI__HUBSPOTPROPERTYUPDATEPERIODSECONDS}
      - Companies__DatabaseConnectionString=${COMPANIES__DATABASECONNECTIONSTRING}
      - Audit__CosmosDbAuditStorage__DatabaseId=${AUDIT__COSMOSDBAUDITSTORAGE__DATABASEID}
      - Audit__CosmosDbAuditStorage__ConnectionString=${AUDIT__COSMOSDBAUDITSTORAGE__CONNECTIONSTRING}
      - Audit__DatabaseConnectionString=${AUDIT__DATABASECONNECTIONSTRING}
      - Audit__RecalculateOverview__MaxDegreeOfParallelism=${AUDIT__RECALCULATEOVERVIEW__MAXDEGREEOFPARALLELISM}
      - Audit__RecalculateOverview__UpdatePeriodSeconds=${AUDIT__RECALCULATEOVERVIEW__UPDATEPERIODSECONDS}
      - Audit__RecalculateOverview__IsEnabled=${AUDIT__RECALCULATEOVERVIEW__ISENABLED}
      - Audit__Attachments__RootContainer=${AUDIT__ATTACHMENTS__ROOTCONTAINER}
      - Audit__Attachments__ConnectionString=${AUDIT__ATTACHMENTS__CONNECTIONSTRING}
      - Audit__Reports__RootContainer=${AUDIT__REPORTS__ROOTCONTAINER}
      - Audit__Reports__ConnectionString=${AUDIT__REPORTS__CONNECTIONSTRING}
      - OptiContent__BlobStorageOptions__ConnectionString=${OPTICONTENT__BLOBSTORAGEOPTIONS__CONNECTIONSTRING}
      - OptiContent__BlobStorageOptions__ContainerName=${OPTICONTENT__BLOBSTORAGEOPTIONS__CONTAINERNAME}
      - OptiContent__BlobStorageOptions__MaxConcurrency=${OPTICONTENT__BLOBSTORAGEOPTIONS__MAXCONCURRENCY}
      - OptiContent__BlobStorageOptions__MaxTransferSizeInMb=${OPTICONTENT__BLOBSTORAGEOPTIONS__MAXTRANSFERSIZEINMB}
      - ServiceBusOptions__ConnectionString=${OPTICONTENT__SERVICEBUSOPTIONS__CONNECTIONSTRING}
      - OptiContent__ServiceBusOptions__VehicleProcessedQueueName=${OPTICONTENT__SERVICEBUSOPTIONS__VEHICLEPROCESSEDQUEUENAME}
      - OptiContent__ServiceBusOptions__VehicleProcessedMaxConcurrentCalls=${OPTICONTENT__SERVICEBUSOPTIONS__VEHICLEPROCESSEDMAXCONCURRENTCALLS}
      - OptiContent__ServiceBusOptions__VehicleDataDeletedQueueName=${OPTICONTENT__SERVICEBUSOPTIONS__VEHICLEDATADELETEDQUEUENAME}
      - OptiContent__ServiceBusOptions__VehicleDataDeletedMaxConcurrentCalls=${OPTICONTENT__SERVICEBUSOPTIONS__VEHICLEDATADELETEDMAXCONCURRENTCALLS}
      - OptiContent__ServiceBusOptions__VehicleVideoAddedQueueName=${OPTICONTENT__SERVICEBUSOPTIONS__VEHICLEVIDEOADDEDQUEUENAME}
      - OptiContent__ServiceBusOptions__VehicleVideoAddedMaxConcurrentCalls=${OPTICONTENT__SERVICEBUSOPTIONS__VEHICLEVIDEOADDEDMAXCONCURRENTCALLS}
      - OptiContent__OpticontentInfrastructureOptions__DatabaseId=${OPTICONTENT__OPTICONTENTINFRASTRUCTUREOPTIONS__DATABASEID}
      - OptiContent__OpticontentInfrastructureOptions__ConnectionString=${OPTICONTENT__OPTICONTENTINFRASTRUCTUREOPTIONS__CONNECTIONSTRING}
      - OptiContent__OpticontentInfrastructureOptions__Throughput=${OPTICONTENT__OPTICONTENTINFRASTRUCTUREOPTIONS__THROUGHPUT}
      - OptiContent__OpticontentInfrastructureOptions__UseIntegratedCache=${OPTICONTENT__OPTICONTENTINFRASTRUCTUREOPTIONS__USEINTEGRATEDCACHE}
      - OptiContent__OpticontentInfrastructureUsersManagementOptions__DatabaseId=${OPTICONTENT__OPTICONTENTINFRASTRUCTUREUSERMANAGEMENTOPTIONS__DATABASEID}
      - OptiContent__OpticontentInfrastructureUsersManagementOptions__ConnectionString=${OPTICONTENT__OPTICONTENTINFRASTRUCTUREUSERMANAGEMENTOPTIONS__CONNECTIONSTRING}
      - OptiContent__OpticontentInfrastructureUsersManagementOptions__Throughput=${OPTICONTENT__OPTICONTENTINFRASTRUCTUREUSERMANAGEMENTOPTIONS__THROUGHPUT}
      - OptiContent__OpticontentInfrastructureUsersManagementOptions__UseIntegratedCache=${OPTICONTENT__OPTICONTENTINFRASTRUCTUREUSERMANAGEMENTOPTIONS__USEINTEGRATEDCACHE}
      - Localization__ProjectId=${LOCALIZATION__PROJECT_ID}
      - Localization__ApiKey=${LOCALIZATION__APIKEY}
      - Localization__AllowAutomaticSync=${LOCALIZATION__ALLOWAUTOMATICSYNC}
      - Localization__LocizeUpdatePeriodInHours=${LOCALIZATION__LOCIZEUPDATEPERIODINHOURS}
      - BI__RootContainer=${BI__ROOTCONTAINER}
      - BI__RootContainerAudits=${BI__ROOTCONTAINERAUDITS}
      - BI__ConnectionString=${BI__CONNECTIONSTRING}
      - AzureServiceBus__ConnectionString=${AZURESERVICEBUS__CONNECTIONSTRING}
      - OptipixWebhooksOptions__HashKey=${OPTIPIXWEBHOOKSOPTIONS__HASHKEY}
      - CloudlayerOptions__ApiKey=${CLOUDLAYEROPTIONS__APIKEY}
      - AssetsStorageOptions__BaseUrl=${ASSETSSTORAGEOPTIONS__BASEURL}
      - NotificationService__ServiceAddress=${NOTIFICATIONSERVICE__SERVICEADDRESS}
      - NotificationService__SuppressContextNotFound=${NOTIFICATIONSERVICE__SUPPRESSCONTEXTNOTFOUND}
      - NotificationService__CallDeadlineInSeconds=${NOTIFICATIONSERVICE__CALLDEADLINEINSECONDS}
      - NotificationService__MaxRetryCount=${NOTIFICATIONSERVICE__MAXRETRYCOUNT}
      - CarOpticomConfiguration__CarOpticomConfigurationInfrastructureOptions__DatabaseId=${CAROPTICOMCONFIGURATION__CAROPTICOMCONFIGURATIONINFRASTRUCTUREOPTIONS__DATABASEID}
      - CarOpticomConfiguration__CarOpticomConfigurationInfrastructureOptions__ConnectionString=${CAROPTICOMCONFIGURATION__CAROPTICOMCONFIGURATIONINFRASTRUCTUREOPTIONS__CONNECTIONSTRING}
      - CarOpticomConfiguration__CarOpticomConfigurationInfrastructureOptions__Throughput=${CAROPTICOMCONFIGURATION__CAROPTICOMCONFIGURATIONINFRASTRUCTUREOPTIONS__THROUGHPUT}
      - CarOpticomConfiguration__CarOpticomConfigurationInfrastructureOptions__UseIntegratedCache=${CAROPTICOMCONFIGURATION__CAROPTICOMCONFIGURATIONINFRASTRUCTUREOPTIONS__USEINTEGRATEDCACHE}
      - CarOpticomConfiguration__CarOpticomConfigurationInfrastructureUsersManagementOptions__DatabaseId=${CAROPTICOMCONFIGURATION__CAROPTICOMCONFIGURATIONINFRASTRUCTUREUSERSMANAGEMENTOPTIONS__DATABASEID}
      - CarOpticomConfiguration__CarOpticomConfigurationInfrastructureUsersManagementOptions__ConnectionString=${CAROPTICOMCONFIGURATION__CAROPTICOMCONFIGURATIONINFRASTRUCTUREUSERSMANAGEMENTOPTIONS__CONNECTIONSTRING}
      - CarOpticomConfiguration__CarOpticomConfigurationInfrastructureUsersManagementOptions__Throughput=${CAROPTICOMCONFIGURATION__CAROPTICOMCONFIGURATIONINFRASTRUCTUREUSERSMANAGEMENTOPTIONS__THROUGHPUT}
      - CarOpticomConfiguration__CarOpticomConfigurationInfrastructureUsersManagementOptions__UseIntegratedCache=${CAROPTICOMCONFIGURATION__CAROPTICOMCONFIGURATIONINFRASTRUCTUREUSERSMANAGEMENTOPTIONS__USEINTEGRATEDCACHE}
      - OptiLeads__OptiLeadsInfrastructureOptions__DatabaseId=${OPTILEADS__OPTILEADSINFRASTRUCTUREOPTIONS__DATABASEID}
      - OptiLeads__OptiLeadsInfrastructureOptions__ConnectionString=${OPTILEADS__OPTILEADSINFRASTRUCTUREOPTIONS__CONNECTIONSTRING}
      - OptiLeads__OptiLeadsInfrastructureOptions__Throughput=${OPTILEADS__OPTILEADSINFRASTRUCTUREOPTIONS__THROUGHPUT}
      - OptiLeads__OptiLeadsInfrastructureOptions__UseIntegratedCache=${OPTILEADS__OPTILEADSINFRASTRUCTUREOPTIONS__USEINTEGRATEDCACHE}
      - OptiLeads__OptiLeadsEmailServiceBusOptions__OptiLeadsEmailQueueName=${OPTILEADS__OPTILEADSEMAILSERVICEBUSOPTIONS__OPTILEADSEMAILQUEUENAME}
      - OptiLeads__OptiLeadsEmailServiceBusOptions__OptiLeadsEmailMaxConcurrentCalls=${OPTILEADS__OPTILEADSEMAILSERVICEBUSOPTIONS__OPTILEADSEMAILMAXCONCURRENTCALLS}
      - OptiProduct__OptiProductInfrastructureOptions__DatabaseId=${OPTIPRODUCT__OPTIPRODUCTINFRASTRUCTUREOPTIONS__DATABASEID}
      - OptiProduct__OptiProductInfrastructureOptions__ConnectionString=${OPTIPRODUCT__OPTIPRODUCTINFRASTRUCTUREOPTIONS__CONNECTIONSTRING}
      - OptiProduct__OptiProductInfrastructureOptions__Throughput=${OPTIPRODUCT__OPTIPRODUCTINFRASTRUCTUREOPTIONS__THROUGHPUT}
      - OptiProduct__OptiProductInfrastructureOptions__UseIntegratedCache=${OPTIPRODUCT__OPTIPRODUCTINFRASTRUCTUREOPTIONS__USEINTEGRATEDCACHE}
      - OptiProduct__OptiProductInfrastructureUsersManagementOptions__DatabaseId=${OPTIPRODUCT__OPTIPRODUCTINFRASTRUCTUREUSERSMANAGEMENTOPTIONS__DATABASEID}
      - OptiProduct__OptiProductInfrastructureUsersManagementOptions__ConnectionString=${OPTIPRODUCT__OPTIPRODUCTINFRASTRUCTUREUSERSMANAGEMENTOPTIONS__CONNECTIONSTRING}
      - OptiProduct__OptiProductInfrastructureUsersManagementOptions__Throughput=${OPTIPRODUCT__OPTIPRODUCTINFRASTRUCTUREUSERSMANAGEMENTOPTIONS__THROUGHPUT}
      - OptiProduct__OptiProductInfrastructureUsersManagementOptions__UseIntegratedCache=${OPTIPRODUCT__OPTIPRODUCTINFRASTRUCTUREUSERSMANAGEMENTOPTIONS__USEINTEGRATEDCACHE}
      - OptiConfigAPI__Url=${OPTICONFIGAPI__URL}
      - OptiConfigAPI__Email=${OPTICONFIGAPI__EMAIL}
      - OptiConfigAPI__Password=${OPTICONFIGAPI__PASSWORD}
    networks:
      - caropticom_frontend
  caropticom-notification:
    image: acrcaropticomwesteuropedev002.azurecr.io/caropticom-notification-api:${CAROPTICOM_NOTIFICATION_VERSION}
    ports:
      - "${CAROPTICOM_NOTIFICATION_HTTP_PORT}:8080"
      - "${CAROPTICOM_NOTIFICATION_HTTPS_PORT}:8081"
      - "${CAROPTICOM_NOTIFICATION_HTTP2_PORT}:8585"
    volumes:
      - ${HTTPS_CERT_PATH}/${HTTPS_CERT_NAME_KEY}:/usr/local/share/ssl/${HTTPS_CERT_NAME_KEY}:ro
    environment:
      - ASPNETCORE_ENVIRONMENT=${DOTNET_ENVIRONMENT:-production}
      - ASPNETCORE_HTTP_PORTS=8080
      - ASPNETCORE_HTTPS_PORTS=8081
      - ASPNETCORE_Kestrel__Certificates__Default__Path=/usr/local/share/ca-certificates/${HTTPS_CERT_NAME_CRT}
      - ASPNETCORE_Kestrel__Certificates__Default__KeyPath=/usr/local/share/ssl/${HTTPS_CERT_NAME_KEY}
      - OltpEndPointUrl=${OLTP_ENDPOINT_URL}
      - Serilog__WriteTo__1__Args__serverUrl=${SEQ_SERVER_URL}
      - OltpAppName=${CAROPTICOM_NOTIFICATION_OLTP_APP_NAME}
      - SENTRY_DSN=${CAROPTICOM_API_SENTRY_DSN:-}
      - Logging__LogLevel__Default=${LOGGING__LOGLEVEL__DEFAULT:-Debug}
      - Logging__LogLevel__Microsoft.AspnetCore=${LOGGING__LOGLEVEL__MICROSOFTASPNETCORE:-Information}
      - Logging__LogLevel__System=${LOGGING__LOGLEVEL__MICROSOFT:-Information}
      - Logging__ApplicationInsights__LogLevel__System=${LOGGING__LOGLEVEL__MICROSOFT:-Information}
      - NotificationInfrastructure__DisplayName=${CAROPTICOM_NOTIFICATION_NOTIFICATIONINFRASTRUCTURE_DISPLAYNAME}
      - NotificationInfrastructure__From=${CAROPTICOM_NOTIFICATION_NOTIFICATIONINFRASTRUCTURE_FROM}
      - NotificationInfrastructure__Host=${CAROPTICOM_NOTIFICATION_NOTIFICATIONINFRASTRUCTURE_HOST}
      - NotificationInfrastructure__Port=${CAROPTICOM_NOTIFICATION_NOTIFICATIONINFRASTRUCTURE_PORT}
      - NotificationInfrastructure__UserName=${CAROPTICOM_NOTIFICATION_NOTIFICATIONINFRASTRUCTURE_USERNAME}
      - NotificationInfrastructure__Password=${CAROPTICOM_NOTIFICATION_NOTIFICATIONINFRASTRUCTURE_PASSWORD}
      - NotificationInfrastructure__AttachmentsSizeLimitInMb=${CAROPTICOM_NOTIFICATION_NOTIFICATIONINFRASTRUCTURE_ATTACHMENTSSIZELIMITINMB}
      - Localization__ProjectId=${LOCALIZATION__PROJECT_ID}
      - Localization__ApiKey=${LOCALIZATION__APIKEY}
      - Localization__AllowAutomaticSync=${LOCALIZATION__ALLOWAUTOMATICSYNC}
      - Localization__LocizeUpdatePeriodInHours=${LOCALIZATION__LOCIZEUPDATEPERIODINHOURS}
      - AssetsStorageOptions__BaseUrl=${ASSETSSTORAGEOPTIONS__BASEURL}
    networks:
      - caropticom_frontend
  caropticom-optipix-webhooks-api:
    image: acrcaropticomwesteuropedev002.azurecr.io/caropticom-optipix-webhooks-api:${CAROPTICOM_OPTIPIX_WEBHOOKS_API_VERSION}
    ports:
      - "${CAROPTICOM_OPTIPIX_WEBHOOKS_API_HTTP_PORT}:8080"
      - "${CAROPTICOM_OPTIPIX_WEBHOOKS_API_HTTPS_PORT}:8081"
    volumes:
      - ${HTTPS_CERT_PATH}/${HTTPS_CERT_NAME_KEY}:/usr/local/share/ssl/${HTTPS_CERT_NAME_KEY}:ro
    environment:
      - ASPNETCORE_ENVIRONMENT=${DOTNET_ENVIRONMENT:-production}
      - ASPNETCORE_HTTP_PORTS=8080
      - ASPNETCORE_HTTPS_PORTS=8081
      - ASPNETCORE_Kestrel__Certificates__Default__Path=/usr/local/share/ca-certificates/${HTTPS_CERT_NAME_CRT}
      - ASPNETCORE_Kestrel__Certificates__Default__KeyPath=/usr/local/share/ssl/${HTTPS_CERT_NAME_KEY}
      - OltpEndPointUrl=${OLTP_ENDPOINT_URL}
      - Serilog__WriteTo__1__Args__serverUrl=${SEQ_SERVER_URL}
      - OltpAppName=${CAROPTICOM_OPTIPIX_WEBHOOKS_API_OLTP_APP_NAME}
      - SENTRY_DSN=${CAROPTICOM_API_SENTRY_DSN:-}
      - Logging__LogLevel__Default=${LOGGING__LOGLEVEL__DEFAULT:-Debug}
      - Logging__LogLevel__Microsoft.AspnetCore=${LOGGING__LOGLEVEL__MICROSOFTASPNETCORE:-Information}
      - Logging__LogLevel__System=${LOGGING__LOGLEVEL__MICROSOFT:-Information}
      - Logging__ApplicationInsights__LogLevel__System=${LOGGING__LOGLEVEL__MICROSOFT:-Information}
      - BlobStorageOptions__ConnectionString=${OPTICONTENT__BLOBSTORAGEOPTIONS__CONNECTIONSTRING}
      - BlobStorageOptions__ContainerName=${OPTICONTENT__BLOBSTORAGEOPTIONS__CONTAINERNAME}
      - BlobStorageOptions__MaxConcurrency=${OPTICONTENT__BLOBSTORAGEOPTIONS__MAXCONCURRENCY}
      - BlobStorageOptions__MaxTransferSizeInMb=${OPTICONTENT__BLOBSTORAGEOPTIONS__MAXTRANSFERSIZEINMB}
      - ServiceBusOptions__ConnectionString=${OPTICONTENT__SERVICEBUSOPTIONS__CONNECTIONSTRING}
      - ServiceBusOptions__VehicleProcessedQueueName=${OPTICONTENT__SERVICEBUSOPTIONS__VEHICLEPROCESSEDQUEUENAME}
      - ServiceBusOptions__VehicleProcessedMaxConcurrentCalls=${OPTICONTENT__SERVICEBUSOPTIONS__VEHICLEPROCESSEDMAXCONCURRENTCALLS}
      - ServiceBusOptions__VehicleDataDeletedQueueName=${OPTICONTENT__SERVICEBUSOPTIONS__VEHICLEDATADELETEDQUEUENAME}
      - ServiceBusOptions__VehicleDataDeletedMaxConcurrentCalls=${OPTICONTENT__SERVICEBUSOPTIONS__VEHICLEDATADELETEDMAXCONCURRENTCALLS}
      - ServiceBusOptions__VehicleVideoAddedQueueName=${OPTICONTENT__SERVICEBUSOPTIONS__VEHICLEVIDEOADDEDQUEUENAME}
      - ServiceBusOptions__VehicleVideoAddedMaxConcurrentCalls=${OPTICONTENT__SERVICEBUSOPTIONS__VEHICLEVIDEOADDEDMAXCONCURRENTCALLS}
      - OpticontentInfrastructureOptions__DatabaseId=${OPTICONTENT__OPTICONTENTINFRASTRUCTUREOPTIONS__DATABASEID}
      - OpticontentInfrastructureOptions__ConnectionString=${OPTICONTENT__OPTICONTENTINFRASTRUCTUREOPTIONS__CONNECTIONSTRING}
      - OpticontentInfrastructureOptions__Throughput=${OPTICONTENT__OPTICONTENTINFRASTRUCTUREOPTIONS__THROUGHPUT}
      - OpticontentInfrastructureOptions__UseIntegratedCache=${OPTICONTENT__OPTICONTENTINFRASTRUCTUREOPTIONS__USEINTEGRATEDCACHE}
      - OpticontentInfrastructureUsersManagementOptions__DatabaseId=${OPTICONTENT__OPTICONTENTINFRASTRUCTUREUSERMANAGEMENTOPTIONS__DATABASEID}
      - OpticontentInfrastructureUsersManagementOptions__ConnectionString=${OPTICONTENT__OPTICONTENTINFRASTRUCTUREUSERMANAGEMENTOPTIONS__CONNECTIONSTRING}
      - OpticontentInfrastructureUsersManagementOptions__Throughput=${OPTICONTENT__OPTICONTENTINFRASTRUCTUREUSERMANAGEMENTOPTIONS__THROUGHPUT}
      - OpticontentInfrastructureUsersManagementOptions__UseIntegratedCache=${OPTICONTENT__OPTICONTENTINFRASTRUCTUREUSERMANAGEMENTOPTIONS__USEINTEGRATEDCACHE}
      - OptipixWebhooksOptions__HashKey=${OPTIPIXWEBHOOKSOPTIONS__HASHKEY}
    networks:
      - caropticom_frontend
  caropticom-optipix-webhooks-fileprocessor:
    image: acrcaropticomwesteuropedev002.azurecr.io/caropticom-optipix-webhooks-filesprocessor:${CAROPTICOM_OPTIPIX_WEBHOOKS_FILES_PROCESSOR_VERSION}
    ports:
      - "${CAROPTICOM_OPTIPIX_WEBHOOKS_FILES_PROCESSOR_HTTP_PORT}:8080"
      - "${CAROPTICOM_OPTIPIX_WEBHOOKS_FILES_PROCESSOR_HTTPS_PORT}:8081"
    volumes:
      - ${HTTPS_CERT_PATH}/${HTTPS_CERT_NAME_KEY}:/usr/local/share/ssl/${HTTPS_CERT_NAME_KEY}:ro
    environment:
      - ASPNETCORE_ENVIRONMENT=${DOTNET_ENVIRONMENT:-production}
      - ASPNETCORE_HTTP_PORTS=8080
      - ASPNETCORE_HTTPS_PORTS=8081
      - ASPNETCORE_Kestrel__Certificates__Default__Path=/usr/local/share/ca-certificates/${HTTPS_CERT_NAME_CRT}
      - ASPNETCORE_Kestrel__Certificates__Default__KeyPath=/usr/local/share/ssl/${HTTPS_CERT_NAME_KEY}
      - OltpEndPointUrl=${OLTP_ENDPOINT_URL}
      - Serilog__WriteTo__1__Args__serverUrl=${SEQ_SERVER_URL}
      - OltpAppName=${CAROPTICOM_OPTIPIX_WEBHOOKS_FILES_PROCESSOR_OLTP_APP_NAME}
      - SENTRY_DSN=${CAROPTICOM_API_SENTRY_DSN:-}
      - Logging__LogLevel__Default=${LOGGING__LOGLEVEL__DEFAULT:-Debug}
      - Logging__LogLevel__Microsoft.AspnetCore=${LOGGING__LOGLEVEL__MICROSOFTASPNETCORE:-Information}
      - Logging__LogLevel__System=${LOGGING__LOGLEVEL__MICROSOFT:-Information}
      - Logging__ApplicationInsights__LogLevel__System=${LOGGING__LOGLEVEL__MICROSOFT:-Information}
      - BlobStorageOptions__ConnectionString=${OPTICONTENT__BLOBSTORAGEOPTIONS__CONNECTIONSTRING}
      - BlobStorageOptions__ContainerName=${OPTICONTENT__BLOBSTORAGEOPTIONS__CONTAINERNAME}
      - BlobStorageOptions__MaxConcurrency=${OPTICONTENT__BLOBSTORAGEOPTIONS__MAXCONCURRENCY}
      - BlobStorageOptions__MaxTransferSizeInMb=${OPTICONTENT__BLOBSTORAGEOPTIONS__MAXTRANSFERSIZEINMB}
      - ServiceBusOptions__ConnectionString=${OPTICONTENT__SERVICEBUSOPTIONS__CONNECTIONSTRING}
      - ServiceBusOptions__VehicleProcessedQueueName=${OPTICONTENT__SERVICEBUSOPTIONS__VEHICLEPROCESSEDQUEUENAME}
      - ServiceBusOptions__VehicleProcessedMaxConcurrentCalls=${OPTICONTENT__SERVICEBUSOPTIONS__VEHICLEPROCESSEDMAXCONCURRENTCALLS}
      - ServiceBusOptions__VehicleDataDeletedQueueName=${OPTICONTENT__SERVICEBUSOPTIONS__VEHICLEDATADELETEDQUEUENAME}
      - ServiceBusOptions__VehicleDataDeletedMaxConcurrentCalls=${OPTICONTENT__SERVICEBUSOPTIONS__VEHICLEDATADELETEDMAXCONCURRENTCALLS}
      - ServiceBusOptions__VehicleVideoAddedQueueName=${OPTICONTENT__SERVICEBUSOPTIONS__VEHICLEVIDEOADDEDQUEUENAME}
      - ServiceBusOptions__VehicleVideoAddedMaxConcurrentCalls=${OPTICONTENT__SERVICEBUSOPTIONS__VEHICLEVIDEOADDEDMAXCONCURRENTCALLS}
      - OpticontentInfrastructureOptions__DatabaseId=${OPTICONTENT__OPTICONTENTINFRASTRUCTUREOPTIONS__DATABASEID}
      - OpticontentInfrastructureOptions__ConnectionString=${OPTICONTENT__OPTICONTENTINFRASTRUCTUREOPTIONS__CONNECTIONSTRING}
      - OpticontentInfrastructureOptions__Throughput=${OPTICONTENT__OPTICONTENTINFRASTRUCTUREOPTIONS__THROUGHPUT}
      - OpticontentInfrastructureOptions__UseIntegratedCache=${OPTICONTENT__OPTICONTENTINFRASTRUCTUREOPTIONS__USEINTEGRATEDCACHE}
      - OpticontentInfrastructureUsersManagementOptions__DatabaseId=${OPTICONTENT__OPTICONTENTINFRASTRUCTUREUSERMANAGEMENTOPTIONS__DATABASEID}
      - OpticontentInfrastructureUsersManagementOptions__ConnectionString=${OPTICONTENT__OPTICONTENTINFRASTRUCTUREUSERMANAGEMENTOPTIONS__CONNECTIONSTRING}
      - OpticontentInfrastructureUsersManagementOptions__Throughput=${OPTICONTENT__OPTICONTENTINFRASTRUCTUREUSERMANAGEMENTOPTIONS__THROUGHPUT}
      - OpticontentInfrastructureUsersManagementOptions__UseIntegratedCache=${OPTICONTENT__OPTICONTENTINFRASTRUCTUREUSERMANAGEMENTOPTIONS__USEINTEGRATEDCACHE}
      - OptipixWebhooksOptions__HashKey=${OPTIPIXWEBHOOKSOPTIONS__HASHKEY}
    networks:
      - caropticom_frontend